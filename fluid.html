<link rel="icon" href="drive-logo.png">
<title>DrivePlyr - Google Drive Proxy Video Player with Many Powerful HTML5 Players</title>

<!-- Meta & SEO Tags skipped for brevity (same as before) -->

<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: black;
  }
  video {
    width: 100%;
    height: 100%;
    object-fit: contain !important;
    display: block;
    background-color: black;
  }
  video:-webkit-full-screen,
  video:-moz-full-screen,
  video:fullscreen {
    object-fit: contain !important;
    background-color: black;
  }
</style>

<script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>

<video poster="https://bit.ly/bbsampleposter" id="video-id" playsinline controls>
  <source src="https://bit.ly/bbsamplevideo" type="video/mp4" />
</video>

<script>
  var apikey = [
    'AIzaSyCt3DULzE2trDJhfFUosWZT-3GEObbMqVU',
    'AIzaSyCsbx8BSyLwkw6XX6Lg5OF1U0HNtI9VmCY',
    'AIzaSyBLMJAT6oqTZxAMsCsMjXzoo4lkJL4MmfM',
    'AIzaSyCIY6fomcJxOt0XQ_naa1rzfd5wlOMGKDY'
  ][Math.floor(Math.random() * 4)];

  function getparam(a, e) {
    return e || (e = window.location.href), new URL(e).searchParams.get(a)
  }

  let video = document.getElementById('video-id');
  if (getparam('id')) {
    let json = JSON.parse(atob(getparam('id')));
    let driveid = json.id;
    video.src = `https://www.googleapis.com/drive/v3/files/${driveid}?alt=media&key=${apikey}`;
    video.poster = 'https://lh3.googleusercontent.com/d/' + driveid;
  }

  var myFP = fluidPlayer('video-id', {
    "layoutControls": {
      "controlBar": {
        "autoHideTimeout": 3,
        "animated": true,
        "autoHide": true
      },
      "htmlOnPauseBlock": {
        "html": null,
        "height": null,
        "width": null
      },
      "autoPlay": false,
      "mute": false,
      "allowTheatre": true,
      "playPauseAnimation": true,
      "playbackRateEnabled": true,
      "allowDownload": true,
      "playButtonShowing": true,
      "fillToContainer": true,
      "posterImage": "",
      "pictureInPictureEnabled": true
    },
    "vastOptions": {
      "adList": [],
      "adCTAText": false,
      "adCTATextPosition": ""
    }
  });

  // ✅ Force screen landscape orientation on fullscreen
  function forceRotation() {
    if (screen.orientation && screen.orientation.lock) {
      screen.orientation.lock("landscape-primary").catch(function (error) {
        console.log("Orientation lock failed:", error);
      });
    }
  }

  function onFullscreenChange() {
    if (
      document.fullscreenElement ||
      document.webkitFullscreenElement ||
      document.mozFullScreenElement ||
      document.msFullscreenElement
    ) {
      forceRotation();
    }
  }

  document.addEventListener("fullscreenchange", onFullscreenChange);
  document.addEventListener("webkitfullscreenchange", onFullscreenChange);
  document.addEventListener("mozfullscreenchange", onFullscreenChange);
  document.addEventListener("MSFullscreenChange", onFullscreenChange);

  // ✅ Fix PiP button to always trigger native PiP manually
  setInterval(() => {
    let pipBtn = document.querySelector('.fp-pip-toggle'); // Fluid Player PiP button class
    if (pipBtn && !pipBtn.hasAttribute('data-pip-added')) {
      pipBtn.setAttribute('data-pip-added', 'true');
      pipBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        try {
          if (document.pictureInPictureElement) {
            await document.exitPictureInPicture();
          } else {
            await video.requestPictureInPicture();
          }
        } catch (err) {
          console.error('PiP error:', err);
        }
      });
    }
  }, 500);
</script>
